@page "/dynamic/{TableId:int}/{Operation}/{RecordId:int?}"
@using modulum.Shared.Enum
@using modulum.Client.Infrastructure.Converter

<MudContainer Class="my-4 px-4">
    <MudOverlay @bind-Visible="@_loading" DarkBackground="true" Absolute="true">
        <modulum.Shared.Loading />
    </MudOverlay>
    @if (_loadingDados)
    {
        <MudAlert Severity="Severity.Warning" ContentAlignment="HorizontalAlignment.Start" Dense="false" Class="p-3">Carregando...</MudAlert>
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7" />
    }
    else
    {
        <MudText Typo="Typo.h4" Style="font-weight: bold" Class="ml-4">
            <MudIcon Icon="@Icons.Material.Filled.Insights" Class="mr-1 mb-n1" Size="Size.Large" />
            @_registro.NomeTela
        </MudText>
        <MudAlert Class="mt-4" Severity="Severity.Normal" NoIcon="true" Variant="Variant.Text" Elevation="0">
            <MudStack Row="true" Justify="Justify.SpaceAround">
                <MudText>Cadastre altere ou visualize seu registro</MudText>
            </MudStack>
        </MudAlert>
        <EditForm Model="_registro" OnValidSubmit="SalvarRegistro">
            <MudPaper Class="mt-4 p-4" Elevation="0" Outlined="true">
                @foreach (var campo in _campos)
                {
                    bool IsPrimaryKey = false;
                    if (campo.IsPrimaryKey && !string.IsNullOrEmpty(campo.Valor) && !Operation.Equals("insert"))
                    {
                        IsPrimaryKey = true;
                    }
                    if (campo.Tipo == TypeColumnEnum.VARCHAR)
                    {
                        <MudTextField T="string" @bind-Value="campo.Valor" Label="@campo.NomeCampoTela" Disabled="@(IsView | IsPrimaryKey)" Variant="Variant.Text" Class="mb-3" Required="@campo.IsObrigatorio" />
                    }
                    else if (campo.Tipo == TypeColumnEnum.INT)
                    {
                        <MudNumericField T="string" @bind-Value="campo.Valor" Label="@campo.NomeCampoTela" Disabled="@(IsView | IsPrimaryKey)" Variant="Variant.Text" Class="mb-3" Required="@campo.IsObrigatorio" />
                    }
                    else if (campo.Tipo == TypeColumnEnum.DATE)
                    {
                        <MudTextField InputType="InputType.DateTimeLocal" @bind-Value="campo.Valor" Label="@campo.NomeCampoTela" Disabled="@(IsView | IsPrimaryKey)" Variant="Variant.Text" Class="mb-3" Required="@campo.IsObrigatorio" />
                    }
                    else if (campo.Tipo == TypeColumnEnum.BIT)
                    {
                        <MudCheckBox Converter="@(new CustomStringToBoolConverter())" @bind-Value="campo.Valor" Label="@campo.NomeCampoTela" Disabled="@(IsView | IsPrimaryKey)" Class="mb-3" Required="@campo.IsObrigatorio" />
                    }
                }
                <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="SalvarRegistro" Class="" Disabled="@IsView">
                    Salvar
                </MudButton>
                <MudButton Variant="Variant.Text" Color="Color.Info" Href=@("/dynamic/" + TableId) Class="">
                    Voltar
                </MudButton>
            </MudPaper>
        </EditForm>
    }
</MudContainer>
